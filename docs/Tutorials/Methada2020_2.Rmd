---
title: 'Methadata 2020: VESPUCCI Exercise n° 2'
author: "Paolo Sonego"
date: "2/14/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

In this second excercise we will use a different normalization technique, the TPM (Transcript Per Million) and show how it is easy to perform analysis outside the VESPUCCI toolbox. We will collect samples from leaf and fruit and fit a Gaussian Mixture Model to both the log-TPM distribution in order to estimate an expression cut-off. Then we will look for genes uniquely expressed in one tissue (fruit) based on the chosen cut-off.

```
%%html
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
```

```{r}
library(pyCOMPASSR)
```

Create a Connect object and pass it the URL to point it to the COMPASS GraphQL endpoint
```{r}
my_conn <- get_connection(url = 'http://compass.fmach.it/graphql')
```

Since COMPASS is our interface to (possibily) many compendium, we'll list all of them and select the one we are interested in, i.e. VITIS_VINIFERA
```{r}
vv_compendium <- my_conn$connection$get_compendium('vitis_vinifera')
```





## Let's get all samples that has been annotated using the term PO_0025034 (LEAF)¶
```{r}
leaf_samples = Sample.using(vv_compendium).get(filter={'annotationOntologyId': 'PO_0025034'})

```

## Show the annotation in triples for the first sample just to show that it is actually a leaf sample
```{r}
Annotation(leaf_samples[0]).get_triples()
```


