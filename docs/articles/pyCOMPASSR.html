<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>pyCOMPASSR - An R interface to COMPASS, the gene expression compendia GraphQL endpoint. • pyCOMPASSR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="pyCOMPASSR - An R interface to COMPASS, the gene expression compendia GraphQL endpoint.">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pyCOMPASSR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/pyCOMPASSR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/onertipaday/pyCOMPASSR">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>pyCOMPASSR - An R interface to COMPASS, the gene expression compendia GraphQL endpoint.</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/onertipaday/pyCOMPASSR/blob/master/vignettes/pyCOMPASSR.Rmd"><code>vignettes/pyCOMPASSR.Rmd</code></a></small>
      <div class="hidden name"><code>pyCOMPASSR.Rmd</code></div>

    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      How to query COMPASS from R
    </div>
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<div id="install" class="section level2">
<h2 class="hasAnchor">
<a href="#install" class="anchor"></a>Install</h2>
</div>
<div id="install-python-and-pip" class="section level2">
<h2 class="hasAnchor">
<a href="#install-python-and-pip" class="anchor"></a>1. Install <code>python</code> and <code>pip</code>
</h2>
<p>1.1. Install <code>python 3</code> (&gt;= 3.3) (<a href="https://www.python.org/downloads">download page</a>)</p>
<p>1.2. Install <code>pip</code> for <code>python</code></p>
<p>1.3. Install <code>reticulate</code> for R</p>
<pre><code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages("reticulate")</a></code></pre>
<p>1.4. Check that <code>reticulate</code> can now find <code>python</code>. You may have to restart RStudio.</p>
<pre><code><a href="https://rdrr.io/pkg/reticulate/man/py_config.html">reticulate::py_config()</a></code></pre>
<p>You will see information about your python configuration, including one or more system paths where python is installed.</p>
<p>1.5. Check that <code>pip</code> can be found</p>
<pre><code><a href="https://rdrr.io/r/base/system.html">system("pip --version")</a></code></pre>
<p>You will see something like <code>pip 19.1.1 from /usr/lib/python3.7/site-packages/pip (python 3.7)</code></p>
</div>
<div id="install-pycompass" class="section level2">
<h2 class="hasAnchor">
<a href="#install-pycompass" class="anchor"></a>2. Install <code>pyCOMPASS</code>
</h2>
<p>2.1. Find the default <code>python</code> path that <code>reticulate</code> is using</p>
<pre><code><a href="https://rdrr.io/pkg/reticulate/man/py_config.html">reticulate::py_config()</a></code></pre>
<p>Take note of the path in the first line (e.g., “/usr/bin/python”).</p>
<p>2.2. Find the path that the system <code>pip</code> command is using</p>
<pre><code><a href="https://rdrr.io/r/base/system.html">system("pip --version")</a></code></pre>
<p>For example, in “pip 19.1.1 from /usr/lib/python3.7/site-packages/pip (python 3.7)” the <code>python</code> path is “/usr/lib/python3.7”. If the path here does not match the py_config() path, then you may need to manually set the path using <code>use_python()</code>.</p>
<pre><code><a href="https://rdrr.io/pkg/reticulate/man/use_python.html">reticulate::use_python("/usr/lib/python3.7", required = TRUE)</a></code></pre>
<p>You may have to restart RStudio before setting the path if you have run other <code>reticulate</code> operations.</p>
<p>2.3. Install <code>pycompass</code> from R</p>
<pre><code># create a new environment 
virtualenv_create("pycompassr")
# install pycompass
virtualenv_install("pycompassr", "pycompass")</code></pre>
<p>2.3. Install <code>pyCOMPASS</code> using <code>pip</code></p>
<pre><code><a href="https://rdrr.io/r/base/system.html">system("pip install pycompass")</a></code></pre>
<p>Or alternatively, run this command in the system terminal (<code>sudo pip install pycompass</code> for Mac users).</p>
<p>2.4. Check if you can now import pyCOMPASS. You may have to restart RStudio.</p>
<pre><code>pycompass &lt;- reticulate::import("pycompass")</code></pre>
</div>
<div id="install-pycompassr" class="section level2">
<h2 class="hasAnchor">
<a href="#install-pycompassr" class="anchor"></a>3. Install <code>pyCOMPASSR</code>
</h2>
<p>3.1. Finally, you can install <code>pyCOMPASSR</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span>(<span class="st">"devtools"</span>)) <span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"devtools"</span>)</a>
<a class="sourceLine" id="cb10-2" title="2">devtools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/devtools/man/remote-reexports.html">install_github</a></span>(<span class="st">"onertipaday/pycompassr"</span>)</a>
<a class="sourceLine" id="cb10-3" title="3"><span class="co"># remotes::install_github("onertipaday/pyCOMPASSR")</span></a></code></pre></div>
</div>
<div id="getting-help" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-help" class="anchor"></a>Getting help</h2>
<p>To get help open an issue on the <code>pyCOMPASSR</code> <a href="https://github.com/onertipaday/pyCOMPASSR/issues">github page</a>.</p>
</div>
<div id="the-resource" class="section level2">
<h2 class="hasAnchor">
<a href="#the-resource" class="anchor"></a>The resource</h2>
<p><a href="http://compass.fmach.it/graphql/">COMPASS</a> GraphQL Endpoint <a href="https://compass-.readthedocs.io/en/latest/index.html">COMPASS documentation</a> <a href="https://github.com/marcomoretto/pyCOMPASS">pyCOMPASS</a></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(pyCOMPASSR)</a></code></pre></div>
</div>
</div>
<div id="case-study" class="section level1">
<h1 class="hasAnchor">
<a href="#case-study" class="anchor"></a>Case Study</h1>
<p>Here we illustrate one of the most common usages of pyCOMPASSR: how to create a module from a set of known genes and automatically selecting condition contrasts. To demonstrate all this we will focus on a set of genes regulated by the phytohormone abscisic acid (ABA) in pre-véraison berries in Vitis vinifera.</p>
<div id="step-1---create-the-initial-module" class="section level2">
<h2 class="hasAnchor">
<a href="#step-1---create-the-initial-module" class="anchor"></a>Step 1 - create the initial module</h2>
<p>We start by creating a module with these 55 ABA modulated genes and refining it by selecting the most co-expressed genes. The module will be manually split to distinguish different condition contrasts, corresponding to different biological contexts, in which ABA affects gene expression. Finally, we will extend these modules to include other relevant genes by coexpression (which could hint at similar forms of regulation).</p>
<p>Get the access to <em>Vitis vinifera</em> compendium:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">vv_compendium &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_compendium.html">get_compendium</a></span>(<span class="dt">species =</span> <span class="st">'vitis_vinifera'</span>)</a></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">aba_genes &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"VIT_05s0077g00430"</span>, <span class="st">"VIT_14s0060g00790"</span>, <span class="st">"VIT_14s0066g00810"</span>, <span class="st">"VIT_16s0050g00390"</span>, <span class="st">"VIT_18s0001g10450"</span>, <span class="st">"VIT_11s0016g03180"</span>, <span class="st">"VIT_08s0058g00470"</span>, <span class="st">"VIT_17s0000g01080"</span>, <span class="st">"VIT_06s0004g04860"</span>, <span class="st">"VIT_00s0322g00030"</span>, <span class="st">"VIT_06s0061g00730"</span>, <span class="st">"VIT_07s0005g00140"</span>, <span class="st">"VIT_00s0934g00010"</span>, <span class="st">"VIT_18s0001g04800"</span>, <span class="st">"VIT_01s0011g04820"</span>, <span class="st">"VIT_00s0216g00060"</span>, <span class="st">"VIT_18s0072g01220"</span>, <span class="st">"VIT_15s0048g02870"</span>, <span class="st">"VIT_00s0203g00070"</span>, <span class="st">"VIT_19s0014g03290"</span>, <span class="st">"VIT_01s0026g02710"</span>, <span class="st">"VIT_17s0000g08080"</span>, <span class="st">"VIT_00s0429g00040"</span>, <span class="st">"VIT_00s1206g00010"</span>, <span class="st">"VIT_09s0002g03690"</span>, <span class="st">"VIT_13s0067g00240"</span>, <span class="st">"VIT_07s0104g00350"</span>, <span class="st">"VIT_04s0023g02480"</span>, <span class="st">"VIT_18s0001g08490"</span>, <span class="st">"VIT_13s0019g02110"</span>, <span class="st">"VIT_04s0008g01120"</span>, <span class="st">"VIT_10s0003g00390"</span>, <span class="st">"VIT_03s0017g01410"</span>, <span class="st">"VIT_08s0007g08030"</span>, <span class="st">"VIT_08s0040g01820"</span>, <span class="st">"VIT_08s0058g01260"</span>, <span class="st">"VIT_09s0002g00630"</span>, <span class="st">"VIT_14s0068g01620"</span>, <span class="st">"VIT_18s0001g01030"</span>, <span class="st">"VIT_16s0050g01880"</span>, <span class="st">"VIT_08s0007g08280"</span>, <span class="st">"VIT_09s0002g06790"</span>, <span class="st">"VIT_09s0002g00640"</span>, <span class="st">"VIT_03s0063g01790"</span>, <span class="st">"VIT_04s0044g01230"</span>, <span class="st">"VIT_08s0040g02610"</span>, <span class="st">"VIT_01s0010g03680"</span>, <span class="st">"VIT_01s0137g00780"</span>, <span class="st">"VIT_02s0025g00500"</span>, <span class="st">"VIT_06s0004g05650"</span>, <span class="st">"VIT_07s0005g01080"</span>, <span class="st">"VIT_13s0156g00100"</span>, <span class="st">"VIT_17s0000g01120"</span>, <span class="st">"VIT_18s0001g07840"</span>, <span class="st">"VIT_18s0001g09290"</span>)</a></code></pre></div>
<p>We can query the compendium with the list of gene names and get a list of BiologicalFeature objects that represents our genes of interest.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">genes &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_bf.html">get_bf</a></span>(<span class="dt">compendium =</span> vv_compendium, <span class="dt">gene_names =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(aba_genes))</a></code></pre></div>
<p>We are now ready to create our first module: the compendium will need the list of genes (BiologicalFeature objects) and the name of the normalization we want to use in order to automatically select the “best” conditions.¶</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">QuickSearch_ABAcoreset &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_module.html">create_module</a></span>(<span class="dt">compendium =</span> vv_compendium, <span class="dt">biofeatures =</span> genes)</a></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="co"># my_plot_html &lt;- plot_heatmap(QuickSearch_ABAcoreset)</span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="co"># tempDir &lt;- tempfile()</span></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="co"># dir.create(tempDir)</span></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="co"># htmlFile &lt;- file.path(tempDir, "plot_heatmap.html")</span></a>
<a class="sourceLine" id="cb16-5" title="5"><span class="co"># xml2::write_html(my_plot_html,file=htmlFile)</span></a>
<a class="sourceLine" id="cb16-6" title="6"><span class="co"># rstudioapi::viewer(htmlFile)</span></a></code></pre></div>
<p>use heatmaply directly from R:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="co"># # plotly::plot_ly(z=mod1$values,type="heatmap")</span></a>
<a class="sourceLine" id="cb17-2" title="2"><span class="co"># heatmaply::heatmaply_cor(QuickSearch_ABAcoreset$values,</span></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="co">#               showticklabels = FALSE,</span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="co">#               #scale = "row",</span></a>
<a class="sourceLine" id="cb17-5" title="5"><span class="co">#               xlab = "Sample Sets",</span></a>
<a class="sourceLine" id="cb17-6" title="6"><span class="co">#               ylab = "Biological Features",</span></a>
<a class="sourceLine" id="cb17-7" title="7"><span class="co">#               k_col = 5,</span></a>
<a class="sourceLine" id="cb17-8" title="8"><span class="co">#               k_row = 3#, show_dendrogram=F</span></a>
<a class="sourceLine" id="cb17-9" title="9"><span class="co">#           )</span></a></code></pre></div>
</div>
</div>
<div id="session-information" class="section level1">
<h1 class="hasAnchor">
<a href="#session-information" class="anchor"></a>Session information</h1>
<pre><code>#&gt; R version 3.6.2 (2019-12-12)
#&gt; Platform: x86_64-redhat-linux-gnu (64-bit)
#&gt; Running under: Fedora 31 (Workstation Edition)
#&gt; 
#&gt; Matrix products: default
#&gt; BLAS/LAPACK: /usr/lib64/R/lib/libRblas.so
#&gt; 
#&gt; attached base packages:
#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     
#&gt; 
#&gt; other attached packages:
#&gt; [1] pyCOMPASSR_0.0.1
#&gt; 
#&gt; loaded via a namespace (and not attached):
#&gt;  [1] Rcpp_1.0.3       rstudioapi_0.11  knitr_1.28       magrittr_1.5    
#&gt;  [5] MASS_7.3-51.5    rappdirs_0.3.1   R6_2.4.1         rlang_0.4.4     
#&gt;  [9] stringr_1.4.0    tools_3.6.2      xfun_0.12        htmltools_0.4.0 
#&gt; [13] yaml_2.2.1       assertthat_0.2.1 digest_0.6.24    rprojroot_1.3-2 
#&gt; [17] pkgdown_1.4.1    crayon_1.3.4     fs_1.3.1         memoise_1.1.0   
#&gt; [21] evaluate_0.14    rmarkdown_2.1    stringi_1.4.5    compiler_3.6.2  
#&gt; [25] desc_1.2.0       backports_1.1.5  reticulate_1.14  jsonlite_1.6.1</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#introduction">Introduction</a><ul class="nav nav-pills nav-stacked">
<li><a href="#install">Install</a></li>
      <li><a href="#install-python-and-pip">1. Install <code>python</code> and <code>pip</code></a></li>
      <li><a href="#install-pycompass">2. Install <code>pyCOMPASS</code></a></li>
      <li><a href="#install-pycompassr">3. Install <code>pyCOMPASSR</code></a></li>
      <li><a href="#getting-help">Getting help</a></li>
      <li><a href="#the-resource">The resource</a></li>
      </ul>
</li>
      <li>
<a href="#case-study">Case Study</a><ul class="nav nav-pills nav-stacked">
<li><a href="#step-1---create-the-initial-module">Step 1 - create the initial module</a></li>
      </ul>
</li>
      <li><a href="#session-information">Session information</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Marco Moretto, Paolo Sonego.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
